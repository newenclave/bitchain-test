


<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/Blog">
    <head>
        





<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>The Bitcoin Script language (pt. 2)</title>

<meta name="author" content="Davide De Rosa" />
<meta name="description" content="In the first part I introduced the Script opcodes for constants and push data. We’re slowly approaching the scripts you’ll include in real transactions. Specifically, we’re bound to deal with hashes and ECDSA signatures at some point, that’s why Script...">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="apple-mobile-web-app-title" content="keeshux">
<meta name="google-site-verification" content="-Pof3b1_qR1iiTunLBZdJwz97Wh63qhs134ZIKNAwyY" />

<!-- Twitter -->


<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@keeshux" />
<meta name="twitter:title" content="The Bitcoin Script language (pt. 2)" />
<meta name="twitter:url" content="http://davidederosa.com/basic-blockchain-programming/bitcoin-script-language-part-two/" />
<meta name="twitter:image" content="http://davidederosa.com/s/f/bitcoin/bitcoin.png?1468962375" />


<meta name="twitter:description" content="In the first part I introduced the Script opcodes for constants and push data. We’re slowly approaching the scripts you’ll include in real transactions. Specifically, we’re bound to deal with hashes and ECDSA signatures at some point, that’s why Script..." />

<!-- Facebook -->

<meta property="og:url" content="http://davidederosa.com/basic-blockchain-programming/bitcoin-script-language-part-two/" />
<meta property="og:title" content="The Bitcoin Script language (pt. 2)" />
<meta property="og:description" content="In the first part I introduced the Script opcodes for constants and push data. We’re slowly approaching the scripts you’ll include in real transactions. Specifically, we’re bound to deal with hashes and ECDSA signatures at some point, that’s why Script..." />
<meta property="og:image" content="http://davidederosa.com/s/f/bitcoin/bitcoin.png?1468962375" />

<!-- Google+ -->

<meta itemprop="name" content="The Bitcoin Script language (pt. 2)" />
<meta itemprop="description" content="In the first part I introduced the Script opcodes for constants and push data. We’re slowly approaching the scripts you’ll include in real transactions. Specifically, we’re bound to deal with hashes and ECDSA signatures at some point, that’s why Script..." />
<meta itemprop="image" content="http://davidederosa.com/s/f/bitcoin/bitcoin.png?1468962375" />

<link rel="canonical" href="index.html" />
<link rel="author" href="https://plus.google.com/+keeshux" />
<link rel="alternate" href="../../feed.xml" type="application/atom+xml" title="Davide De Rosa" />
<link rel="sitemap" href="../../sitemap.xml" type="application/xml" title="Sitemap" />

<link rel="prev" href="../standard-scripts/index.html" title="Standard scripts" />


<link rel="next" href="../bitcoin-script-language-part-one/index.html" title="The Bitcoin Script language (pt. 1)" />


<link rel="stylesheet" href="../../s/main.css@1468962375.css" />
<link rel="stylesheet" href="../../s/main-mobile.css@1468962375.css" media="handheld, only screen and (max-device-width: 600px)" />
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Raleway:600,400" />
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" />

<link rel="shortcut icon" href="../../s/favicon.ico@1468962375" />
<link rel="apple-touch-icon" href="../../s/iphone-icon-precomposed.png@1468962375" />

    </head>
    <body>
        <div id="container">
            <header>
                <nav id="menu">
    <ul>
        
            
            
            <li>
                
                <a class="active" href="../../index.html">stories</a>
                
            </li>
        
            
            
            <li>
                
                <a href="../../work/index.html">work</a>
                
            </li>
        
            
            
            <li>
                
                <a href="../../about/index.html">about</a>
                
            </li>
        
    </ul>
</nav>

            </header>
            <div>
                <header>
                    <h1><a href="../../index.html">Davide De Rosa</a></h1>
                </header>
                <main>
                    <article class="post post-full" itemscope itemtype="http://schema.org/Article">
    <header>
        
<div class="post-icon">
    <a href="index.html">
        
        <img src="../../s/f/bitcoin/bitcoin-150.png" alt="The Bitcoin Script language (pt. 2)" />
        
    </a>
</div>


        <div>
            <span class="post-date" itemprop="datepublished">May 25, 2015</span>
            <h2 itemprop="name">
                
                <a href="https://github.com/keeshux/basic-blockchain-programming" title="The Bitcoin Script language (pt. 2)">The Bitcoin Script language (pt. 2)</a>
                
            </h2>
            <div class="post-list post-categories">
    in
    
    <a href="../../category/basic-blockchain-programming.html">basic blockchain programming</a>
    
</div>

            






<div class="post-list post-series-links">
    part of a <a href="../../basic-blockchain-programming.1.html" title="A developer-oriented series about Bitcoin">series</a>:
    
    <a href="../bitcoin-script-language-part-one/index.html" title="The Bitcoin Script language (pt. 1)">&lt; prev</a>
    
    |
    
    <a href="../standard-scripts/index.html" title="Standard scripts">next &gt;</a>
    
</div>



        </div>
    </header>
    <div class="post-body">
        
<p class="post-see"><a href="https://github.com/keeshux/basic-blockchain-programming" title="The Bitcoin Script language (pt. 2)">
    
    <i class="fa fa-github"></i> See on Github
    
</a></p>


        
<aside class="sharing sharing-buttons">
    <div class="addthis_sharing_toolbox"></div>
</aside>

        

        <p>In the <a href="../bitcoin-script-language-part-one/index.html">first part</a> I introduced the Script opcodes for constants and push data. We’re slowly approaching the scripts you’ll include in real transactions. Specifically, we’re bound to deal with hashes and ECDSA signatures at some point, that’s why Script has even opcodes for crypto functions.</p>

<!--more-->

<h4 id="arithmetic">Arithmetic</h4>

<p>Look at some of the many arithmetic opcodes:</p>

<table>
  <thead>
    <tr>
      <th>opcode</th>
      <th>encoding</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">OP_ADD</code></td>
      <td><code class="highlighter-rouge">93</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">OP_SUB</code></td>
      <td><code class="highlighter-rouge">94</code></td>
    </tr>
  </tbody>
</table>

<p>Both are totally stack-based operations, meaning that they take no explicit argument. <code class="highlighter-rouge">OP_ADD</code> (<code class="highlighter-rouge">OP_SUB</code>) pops the top two items of the stack and adds (substracts) them. The result of the operation is then pushed on top again.</p>

<p>Example:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>55 59 93 56 94
</code></pre>
</div>

<p>or:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>OP_5 OP_9 OP_ADD OP_6 OP_SUB
</code></pre>
</div>

<p>Here’s how the stack evolves:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>[]
[5]
[5, 9]
[14]
[14, 6]
[8]
</code></pre>
</div>

<p>The script returns 8.</p>

<h4 id="comparison">Comparison</h4>

<p>Again, scripts are used for transaction validation, and comparisons are a primary need for a validator:</p>

<table>
  <thead>
    <tr>
      <th>opcode</th>
      <th>encoding</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">OP_EQUAL</code></td>
      <td><code class="highlighter-rouge">87</code></td>
    </tr>
  </tbody>
</table>

<p><code class="highlighter-rouge">OP_EQUAL</code> pops and compares the top two items on the stack, then pushes <code class="highlighter-rouge">OP_TRUE</code> if they’re equal or <code class="highlighter-rouge">OP_FALSE</code> otherwise.</p>

<p>Example:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>02 c3 72 02 03 72 01 c0 93 87
</code></pre>
</div>

<p>or:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>[c3 72] [03 72] [c0] OP_ADD OP_EQUAL
</code></pre>
</div>

<p>Here’s how the stack evolves:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>[]
[c3 72]
[c3 72, 03 72]
[c3 72, 03 72, c0]
[c3 72, c3 72]
[1]
</code></pre>
</div>

<p>It’s worth noting that the script eventually “succeeds”, because it returns <code class="highlighter-rouge">OP_TRUE</code>.</p>

<h4 id="stack-manipulation">Stack manipulation</h4>

<p>This is the only opcode you’re going to use for stack manipulation:</p>

<table>
  <thead>
    <tr>
      <th>opcode</th>
      <th>encoding</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">OP_DUP</code></td>
      <td><code class="highlighter-rouge">76</code></td>
    </tr>
  </tbody>
</table>

<p><code class="highlighter-rouge">OP_DUP</code> takes no arguments, it just duplicates the top stack item.</p>

<p>Example:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>04 b9 0c a2 fe 76 87
</code></pre>
</div>

<p>or:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>[b9 0c a2 fe] OP_DUP OP_EQUAL
</code></pre>
</div>

<p>Here’s how the stack evolves:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>[]
[b9 0c a2 fe]
[b9 0c a2 fe, b9 0c a2 fe]
[1]
</code></pre>
</div>

<p>Obviously, the script succeeds, since <code class="highlighter-rouge">OP_EQUAL</code> would never fail after <code class="highlighter-rouge">OP_DUP</code>!</p>

<h4 id="crypto">Crypto</h4>

<p>These opcodes are certainly the most interesting:</p>

<table>
  <thead>
    <tr>
      <th>opcode</th>
      <th>encoding</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">OP_HASH160</code></td>
      <td><code class="highlighter-rouge">a9</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">OP_CHECKSIG</code></td>
      <td><code class="highlighter-rouge">ac</code></td>
    </tr>
  </tbody>
</table>

<p><code class="highlighter-rouge">OP_HASH160</code> pops the top stack item, performs hash160 on it and then pushes the result back. Basically, this opcode computes the Bitcoin P2PKH address from an ECDSA public key.</p>

<p><code class="highlighter-rouge">OP_CHECKSIG</code> pops the top two stack items, the first being an ECDSA public key and the second being a DER-encoded ECDSA signature. After that, it pushes <code class="highlighter-rouge">OP_TRUE</code> if the signature is valid for that public key or <code class="highlighter-rouge">OP_FALSE</code> otherwise. It’s the Script version of OpenSSL’s <code class="highlighter-rouge">ECDSA_verify</code>.</p>

<p>Both opcodes will be described in the next post.</p>

<h3 id="wheres-the-code">Where’s the code?</h3>

<p>There are no code examples in this chapter. In the end a script is an array of data where your only contribution is mapping opcodes names to raw bytes. We could have developed a tiny Script interpreter, but it’s way beyond our goals. Typical Bitcoin clients don’t run scripts as it’s a mining task, so our concern is just writing well-formed scripts that miners would accept.</p>

<h3 id="next-block-in-chain">Next block in chain?</h3>

<p>You learned some more Script opcodes, including crypto functions essential to ECDSA verifications.</p>

<p>In the <a href="../standard-scripts/index.html">next article</a> we’ll examine the role of keys and addresses in <em>standard scripts</em>. Please share this post if you enjoyed it and use the form below for questions and comments!</p>


        
        
<aside class="sharing sharing-buttons">
    <div class="addthis_sharing_toolbox"></div>
</aside>

    </div>
    <aside class="sharing" id="sharing-me">
    <ul>
        <li><a href="../../feed.xml" title="Subscribe for updates"><i class="fa fa-rss"></i>Subscribe</a></li>
        <li><a href="https://twitter.com/keeshux" title="Follow me on Twitter"><i class="fa fa-twitter"></i>Follow</a></li>
    </ul>
</aside>

    
<aside class="post-list post-tags">
    <i class="fa fa-tags"></i>
    
    <a href="../../tag/bitcoin.html">bitcoin</a>, 
    
    <a href="../../tag/blockchain.html">blockchain</a>, 
    
    <a href="../../tag/programming.html">programming</a>, 
    
    <a href="../../tag/development.html">development</a>, 
    
    <a href="../../tag/transactions.html">transactions</a>, 
    
    <a href="../../tag/script.html">script</a>, 
    
    <a href="../../tag/assembly.html">assembly</a>, 
    
    <a href="../../tag/opcode.html">opcode</a>, 
    
    <a href="../../tag/stack.html">stack</a>, 
    
    <a href="../../tag/hashing.html">hashing</a>, 
    
    <a href="../../tag/ecdsa.html">ecdsa</a>
    
</aside>


    <aside class="post-related">
        <p>See also:</p>
        <ul>
            
            <li><a href="../the-first-transaction-part-two/index.html">The first transaction (pt. 2)</a></li>
            
            <li><a href="../the-first-transaction-part-one/index.html">The first transaction (pt. 1)</a></li>
            
            <li><a href="../inside-transactions/index.html">Inside transactions</a></li>
            
        </ul>
    </aside>
    <div id="disqus_thread"></div>
    <nav class="paginator">
    <ul>
        <li class="paginator-browser newer">
            
            <a href="../standard-scripts/index.html" title="Standard scripts"><i class="fa fa-chevron-left"></i> Newer</a>
            
        </li><li class="paginator-browser home">
            <a href="../../index.html" class="fa fa-home"></a>
        </li><li class="paginator-browser older">
            
            <a href="../bitcoin-script-language-part-one/index.html" title="The Bitcoin Script language (pt. 1)">Older <i class="fa fa-chevron-right"></i></a>
            
        </li>
    </ul>
</nav>

</article>

                </main>
                <footer id="page-footer">
                    <ul id="social">
    <li><a href="https://twitter.com/keeshux" title="Follow me on Twitter!" class="fa fa-twitter"></a></li>
    <li><a href="https://github.com/keeshux" title="Browse my GitHub repository" class="fa fa-github"></a></li>
    <li><a href="https://www.linkedin.com/in/davidederosa" title="See my LinkedIn profile" class="fa fa-linkedin-square"></a></li>
    <li><a href="mailto:website@davidederosa.com" title="Send me an email" class="fa fa-edit"></a></li>
    <li><a href="../../s/keeshux-gpg.txt" title="My GnuPG public key" class="fa fa-lock"></a></li>
</ul>
<p>
    <a href="bitcoin:16w2AWamiH2SS68NYSMDcrbh5MnZ1c5eju" title="Donate in Bitcoin" rel="nofollow">Donate bitcoins</a> to support my work.<br />
    <a href="bitcoin:16w2AWamiH2SS68NYSMDcrbh5MnZ1c5eju" title="Donate in Bitcoin" rel="nofollow" alt="Bitcoin address"><img id="bitcoin-qr" src="../../s/keeshux-bitcoin.svg" /></a>
</p>
<p>&copy; <a href="../../index.html">Davide De Rosa</a>. All rights reserved. <a title="Subscribe to my RSS feed" class="fa fa-rss-square" href="../../feed.xml"></a></p>

                </footer>
            </div>
        </div>
        <script type="text/javascript" src="../../s/main.js@1468962375" async="async"></script>
        <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/javascript" src="http://s7.addthis.com/js/300/addthis_widget.js#pubid=ra-545ff75205bf1590" async="async"></script>
        <script type="text/javascript">
            var addthis_share = {
                'templates': {
                    'twitter': '“Basic blockchain programming”, {{title}} {{url}} #Bitcoin #blockchain via @keeshux'
                }
            };
        </script>
        
        <script type="text/javascript" src="http://keeshux.disqus.com/embed.js" async="async"></script>
        
    </body>
</html>
